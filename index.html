<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Page</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    html, body { margin: 0; padding: 0; }
    body { font-family: 'Raleway', Arial, sans-serif; }
    img { display: block; border: 0; }
    /* Background image behind all content */
    #bg { position: fixed; top: 0; left: 50%; transform: translateX(-50%); height: 100vh; width: auto; z-index: -1; pointer-events: none; }
    #hero { position: relative; }
    #hero.map-view > img:first-child { opacity: 0; visibility: hidden; pointer-events: none; transition: opacity 300ms ease, visibility 300ms ease; }
    #content { position: relative; transition: opacity 300ms ease, visibility 300ms ease; }
    #content.map-view { opacity: 0; visibility: hidden; }
    /* Map view - disable scrolling */
    body.map-view { overflow: hidden; height: 100vh; }
    body.map-view #hero { position: fixed; top: 0; left: 0; right: 0; bottom: 0; height: 100vh; width: 100%; }
    /* Map view sharing section */
    #map-sharing-section {
      position: fixed;
      bottom: 16px;
      left: 0;
      right: 0;
      width: 100%;
      padding: 8px 24px;
      padding-left: calc(16px + 24px);
      padding-right: calc(16px + 24px);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      z-index: 8;
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition: opacity 300ms ease, visibility 300ms ease;
      box-sizing: border-box;
    }
    #map-sharing-section.active {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
    #map-sharing-section .share-instruction {
      margin-top: -8px;
    }
    #title { font-weight: 700; }
    #question { font-style: italic; font-weight: 400; }
    #body { font-weight: 400; }
    .buttons { position: fixed; left: 0; right: 0; bottom: 96px; display: flex; justify-content: space-between; align-items: center; z-index: 9; transition: transform 250ms ease; visibility: hidden; }
    .buttons.ready { visibility: visible; }
    /* Start exactly at the image/description boundary using computed offset */
    .buttons.initial { transform: translateY(var(--btn-initial-offset, 0)); }
    .buttons.revealed { bottom: 15vh; transform: translateY(0); }
    .buttons.default { transform: translateY(0); }
    .btn { display: flex; padding: 8px 18px; justify-content: center; align-items: center; gap: 8px; border-radius: 0 16px 16px 0; background: #FFCEBF; border: 0; font: inherit; font-weight: 400; font-size: 14px; color: #000; cursor: pointer; -webkit-appearance: none; appearance: none; }
    .btn.next { border-radius: 16px 0 0 16px; }
    /* Top-right tools */
    #tools { position: fixed; top: 24px; right: 0; width: 50px; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; z-index: 10; transition: width 300ms ease; }
    .tool { display: flex; padding: 12px; justify-content: flex-start; align-items: center; gap: 8px; align-self: stretch; border-radius: 23px 0 0 23px; background: #FFCEBF; min-width: 42px; box-sizing: border-box; transition: padding 300ms ease, border-radius 300ms ease; }
    .tool-icon { display: block; width: 18px; height: 18px; padding: 0; flex-shrink: 0; }
    .tool-label { font-size: 14px; font-weight: 400; color: #000; white-space: nowrap; opacity: 0; width: 0; overflow: hidden; transition: opacity 250ms ease, width 300ms ease, padding 300ms ease; padding: 0; line-height: 18px; display: flex; align-items: center; }
    .tool-round { display: flex; padding: 0; width: 42px; height: 42px; justify-content: center; align-items: center; gap: 0; border-radius: 23px; background: #FFCEBF; align-self: stretch; box-sizing: border-box; opacity: 0; transform: translateY(-12px); transition: opacity 200ms ease, transform 200ms ease, padding 300ms ease, border-radius 300ms ease, width 300ms ease, height 300ms ease; }
    .tool-round .tool-label { opacity: 0; width: 0; padding: 0; }
    /* State 2: with-labels - when scroll begins */
    #tools.with-labels { width: auto; align-items: flex-end; }
    #tools.with-labels .tool { padding: 12px 16px; border-radius: 23px 0 0 23px; height: 42px; align-self: flex-end; }
    #tools.with-labels .tool-label { opacity: 1; width: auto; padding: 0 0 0 8px; }
    #tools.with-labels .tool-round { opacity: 1; transform: translateY(0); padding: 12px 16px; border-radius: 23px 0 0 23px; width: auto; height: 42px; align-self: flex-end; justify-content: flex-start; align-items: center; }
    #tools.with-labels .tool-round .tool-label { opacity: 1; width: auto; padding: 0 0 0 8px; }
    #tools.with-labels .tool-round:nth-child(2) { transition-delay: 50ms; }
    #tools.with-labels .tool-round:nth-child(3) { transition-delay: 100ms; }
    /* State 3: revealed - individual buttons transition when they cross hero/content boundary */
    #tools.revealed { width: 50px; align-items: flex-start; }
    #tools.revealed .tool { padding: 12px; justify-content: center; align-self: flex-start; }
    #tools.revealed .tool-label { opacity: 0; width: 0; padding: 0; }
    #tools.revealed .tool-round { opacity: 1; transform: translateY(0); padding: 0; width: 42px; height: 42px; border-radius: 23px; justify-content: center; }
    #tools.revealed .tool-round .tool-label { opacity: 0; width: 0; padding: 0; }
    #tools.revealed .tool-round:nth-child(2) { transition-delay: 50ms; }
    #tools.revealed .tool-round:nth-child(3) { transition-delay: 100ms; }
    /* Individual button revealed state - when button crosses hero/content boundary */
    /* First button (.tool) reverts to state 1 appearance */
    .tool.revealed { padding: 12px; width: auto; min-width: 42px; border-radius: 23px 0 0 23px; justify-content: flex-start; align-items: center; }
    .tool.revealed .tool-label { opacity: 0; width: 0; padding: 0; }
    /* Other buttons (.tool-round) become circular */
    .tool-round.revealed { padding: 0; width: 42px; height: 42px; border-radius: 23px; justify-content: center; }
    .tool-round.revealed .tool-label { opacity: 0; width: 0; padding: 0; }
    /* In state 2 (with-labels), keep revealed buttons right-aligned to prevent shifting */
    #tools.with-labels .tool.revealed { padding: 12px; width: auto; min-width: 42px; border-radius: 23px 0 0 23px; justify-content: flex-start; align-self: flex-end; }
    #tools.with-labels .tool-round.revealed { padding: 0; width: 42px; height: 42px; border-radius: 23px; justify-content: center; align-self: flex-end; }
    #tools.with-labels .tool.revealed .tool-label, #tools.with-labels .tool-round.revealed .tool-label { opacity: 0; width: 0; padding: 0; }
    /* When all buttons are revealed, switch to left alignment */
    #tools.all-revealed { align-items: flex-start; }
    #tools.all-revealed .tool.revealed { align-self: flex-start; }
    #tools.all-revealed .tool-round.revealed { align-self: flex-start; }
    /* Preferences card */
    #preferences-card { 
      position: fixed; 
      top: 0;
      bottom: 0; 
      left: 0; 
      right: 0; 
      width: 100%; 
      max-width: 100%; 
      padding: 8px 24px; 
      background: #fff; 
      display: flex; 
      flex-direction: column; 
      align-items: flex-start; 
      gap: 12px; 
      z-index: 100; 
      transform: translateY(100%); 
      transition: transform 300ms ease; 
      box-sizing: border-box; 
      overflow-y: auto; 
    }
    #preferences-card.open { 
      transform: translateY(0); 
    }
    /* Prevent body scroll when preferences card is open */
    body.preferences-open {
      overflow: hidden;
    }
    #preferences-card > div {
      width: 100%;
    }
    /* Preferences header */
    #preferences-header {
      display: flex;
      padding: 8px 0;
      align-items: center;
      gap: 10px;
      align-self: stretch;
    }
    .preferences-back-button {
      display: flex;
      padding: 12px;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
      border-radius: 23px;
      border: 2px solid #333;
    }
    .arrow-left-icon {
      width: 18px;
      height: 18px;
      color: #333;
    }
    .preferences-title {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 20px;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
    }
    /* Narrowsearch */
    #narrowsearch {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      align-self: stretch;
    }
    .narrowsearch-map {
      width: 38vw;
      height: auto;
      object-fit: contain;
      align-self: center;
    }
    .narrowsearch-title {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
    }
    .narrowsearch-question {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      line-height: 22px;
    }
    .location-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .location-yes-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .location-no-button,
    .location-yes-button {
      display: inline-flex;
      padding: 6px 14px;
      justify-content: center;
      align-items: center;
      gap: 8px;
      border-radius: 16px;
      border: 0;
      font: inherit;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
    }
    .location-no-button {
      background: transparent;
      color: #333;
    }
    .location-no-button.active {
      background: #2C2C2C;
      color: #fff;
    }
    .location-yes-button {
      background: transparent;
      color: #333;
    }
    .location-yes-button.active {
      background: #2C2C2C;
      color: #fff;
    }
    .location-icon {
      width: 18px;
      height: 18px;
      display: block;
    }
    /* Icon color changes when button is active */
    .location-no-button.active .location-icon,
    .location-yes-button.active .location-icon {
      filter: brightness(0) invert(1);
    }
    /* Reset icon color when not active */
    .location-no-button:not(.active) .location-icon,
    .location-yes-button:not(.active) .location-icon {
      filter: none;
    }
    .location-note {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 12px;
      font-style: normal;
      font-weight: 300;
      line-height: 22px;
    }
    /* Interests section */
    #interests-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      align-self: stretch;
    }
    .interests-title {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
    }
    .interests-subtitle {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 12px;
      font-style: normal;
      font-weight: 300;
      line-height: normal;
    }
    .interests-list {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      width: 100%;
    }
    .interest-item {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
    }
    .interest-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #333;
    }
    .favourites-map {
      width: 38vw;
      height: auto;
      object-fit: contain;
      align-self: center;
    }
    .share-title,
    .share-start-title {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
    }
    .share-instruction {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 12px;
      font-style: normal;
      font-weight: 300;
      line-height: normal;
    }
    .share-features {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .share-features li {
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      padding-left: 24px;
      position: relative;
    }
    .share-features li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: #333;
      font-weight: 700;
    }
    .share-link-container {
      display: flex;
      gap: 8px;
      width: 100%;
      align-items: center;
    }
    .share-link-input {
      flex: 1;
      padding: 6px 14px;
      border-radius: 16px;
      border: 2px solid #333;
      background: #fff;
      color: #333;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      outline: none;
    }
    .share-copy-button {
      display: inline-flex;
      padding: 6px 14px;
      justify-content: center;
      align-items: center;
      gap: 8px;
      border-radius: 16px;
      background: #2C2C2C;
      color: #fff;
      border: 0;
      font: inherit;
      font-family: 'Raleway', Arial, sans-serif;
      font-size: 16px;
      font-style: normal;
      font-weight: 400;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
    }
  </style>
</head>
<body>
  <!-- Background image -->
  <img id="bg" src="Kuvatõmmis 2025-10-31 102242.png" alt="" aria-hidden="true">

  <div id="hero" style="padding:16px 16px 0 16px;">
    <img src="5.webp" alt="Image" style="width:100%;height:auto;border-radius:16px 16px 0 0;">
    <div id="tools">
      <div class="tool">
        <img src="settings_icon.svg" alt="settings" class="tool-icon">
        <span class="tool-label">preferences</span>
      </div>
      <div class="tool-round">
        <img src="map_icon.svg" alt="map" class="tool-icon">
        <span class="tool-label">location</span>
      </div>
      <div class="tool-round">
        <img src="heart_icon.svg" alt="favorite" class="tool-icon">
        <span class="tool-label">favourite</span>
      </div>
    </div>
    <div id="buttons" class="buttons">
      <button class="btn"><span aria-hidden="true">‹</span><span>prev</span></button>
      <button class="btn next"><span>next</span><span aria-hidden="true">›</span></button>
    </div>
  </div>

  <div id="content" style="margin:0 16px;padding:8px 16px 0 16px;display:flex;flex-direction:column;gap:8px;">
    <div id="title"></div>
    <div id="question"></div>
    <div id="body"></div>
  </div>

  <!-- Map view sharing section -->
  <div id="map-sharing-section">
    <div class="share-start-title">Share your map with others:</div>
    <div class="share-instruction">Copy and share the unique link</div>
    <div class="share-link-container">
      <input type="text" value="www.nuudo.eu/uniqueid" class="share-link-input" readonly>
      <button class="share-copy-button">copy</button>
    </div>
  </div>

  <!-- Preferences card -->
  <div id="preferences-card">
    <div id="preferences-header">
      <div class="preferences-back-button">
        <svg class="arrow-left-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
      </div>
      <div class="preferences-title">Exploration settings</div>
    </div>
    <div id="narrowsearch">
      <img src="map.svg" alt="map" class="narrowsearch-map">
      <div class="narrowsearch-title">Narrow your search:</div>
      <div class="narrowsearch-question">Prioritize objects that are closest to you?</div>
      <div class="location-buttons">
        <button class="location-no-button active">
          <img src="location-pin-no.svg" alt="no location" class="location-icon">
          <span>No</span>
        </button>
        <div class="location-yes-container">
          <button class="location-yes-button">
            <img src="location-pin-yes.svg" alt="yes location" class="location-icon">
            <span>Yes</span>
          </button>
          <span class="location-note">(requires Location Sharing)</span>
        </div>
      </div>
    </div>
    <div id="interests-section">
      <div class="interests-title">What are you interested in?</div>
      <div class="interests-subtitle">(currently showing all)</div>
      <div class="interests-list">
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>Architecture</span>
        </label>
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>Food & drink</span>
        </label>
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>Nature and activities</span>
        </label>
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>History</span>
        </label>
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>Local commerce</span>
        </label>
        <label class="interest-item">
          <input type="checkbox" checked>
          <span>Art</span>
        </label>
      </div>
      <img src="map-favourites.svg" alt="favourites map" class="favourites-map">
      <div class="share-title">Want to share your favourite objects with someone else?</div>
      <ul class="share-features">
        <li>See what they have favourited</li>
        <li>Collaborate to create a single map</li>
        <li>Control who sees your map</li>
      </ul>
      <div class="share-start-title">To get started on exploring together:</div>
      <div class="share-instruction">Copy and share the unique link below:</div>
      <div class="share-link-container">
        <input type="text" value="www.nuudo.eu/uniqueid" class="share-link-input" readonly>
        <button class="share-copy-button">copy</button>
      </div>
    </div>
  </div>

  <script>
  (async function() {
    try {
      const url = 'content_text.txt?v=' + Date.now();
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status + ' ' + res.statusText);
      let text = await res.text();
      // Remove potential BOM
      text = text.replace(/^\uFEFF/, '');

      const titleMatch = text.match(/^\s*title:\s*"([^"]*)"/mi);
      const questionMatch = text.match(/^\s*question:\s*"([^"]*)"/mi);

      const bodyStart = text.indexOf('body:');
      let bodyContent = '';
      if (bodyStart !== -1) {
        const afterLabel = text.indexOf('"', bodyStart);
        const lastQuote = text.lastIndexOf('"');
        if (afterLabel !== -1 && lastQuote !== -1 && lastQuote > afterLabel) {
          bodyContent = text.slice(afterLabel + 1, lastQuote);
        }
      }

      const titleEl = document.getElementById('title');
      const questionEl = document.getElementById('question');
      const bodyEl = document.getElementById('body');

      titleEl.textContent = titleMatch ? titleMatch[1] : '';
      questionEl.textContent = questionMatch ? questionMatch[1] : '';
      bodyEl.innerHTML = bodyContent || '';

      // Fallback: if nothing parsed, show raw content to aid debugging
      if (!titleEl.textContent && !questionEl.textContent && !bodyEl.innerHTML) {
        bodyEl.textContent = text;
      }

      
    } catch (err) {
      const bodyEl = document.getElementById('body');
      bodyEl.textContent = 'Failed to load content: ' + (err && err.message ? err.message : 'unknown error');
    }
  })();
  // Three-state tool system: initial -> with-labels -> revealed
  (function() {
    const tools = document.getElementById('tools');
    const buttons = document.getElementById('buttons');
    const hero = document.getElementById('hero');
    if (!tools || !hero) return;
    
    const computeInitialOffset = function() {
      if (!buttons) return;
      if (window.scrollY > 0) return; // only compute for initial state
      const img = document.querySelector('#hero img');
      if (!img) return;
      const rect = img.getBoundingClientRect();
      const viewportH = window.innerHeight || document.documentElement.clientHeight;
      const btnRect = buttons.getBoundingClientRect();
      // Move so the BUTTONS' CENTER aligns with the image bottom line
      const delta = rect.bottom - (viewportH - 96) + (btnRect.height / 2);
      buttons.style.setProperty('--btn-initial-offset', delta + 'px');
      buttons.classList.add('ready');
    };
    
    if (buttons) {
      buttons.classList.add('initial');
      const img = document.querySelector('#hero img');
      if (img) {
        if (img.complete) {
          computeInitialOffset();
        } else {
          img.addEventListener('load', computeInitialOffset, { once: true });
        }
      } else {
        computeInitialOffset();
      }
    }
    
    const checkHeroInViewport = function() {
      const rect = hero.getBoundingClientRect();
      // Hero is out of viewport when its bottom is above the viewport top
      return rect.bottom > 0;
    };
    
    const getHeroContentBoundary = function() {
      // Get the boundary between hero and content divs (bottom of hero)
      const heroRect = hero.getBoundingClientRect();
      return heroRect.bottom + window.scrollY;
    };
    
    const checkButtonCrossedBoundary = function(button, boundaryY) {
      // Check if the button's vertical center has crossed the boundary
      const buttonRect = button.getBoundingClientRect();
      const buttonCenterY = buttonRect.top + buttonRect.height / 2 + window.scrollY;
      return buttonCenterY > boundaryY;
    };
    
    let hasScrolled = false;
    
    const onScroll = function() {
      // Don't change states if map view is active
      const hero = document.getElementById('hero');
      if (hero && hero.classList.contains('map-view')) {
        return;
      }
      
      const scrollY = window.scrollY;
      
      if (scrollY === 0) {
        if (hasScrolled) {
          // Once we've scrolled, return to state 3 (all revealed) when at top
          tools.classList.remove('with-labels');
          tools.classList.add('revealed', 'all-revealed');
          const allButtons = tools.querySelectorAll('.tool, .tool-round');
          allButtons.forEach(btn => btn.classList.add('revealed'));
        } else {
          // State 1: Initial - no scroll yet, show initial state
          tools.classList.remove('with-labels', 'revealed', 'all-revealed');
          // Remove revealed class from all buttons
          const allButtons = tools.querySelectorAll('.tool, .tool-round');
          allButtons.forEach(btn => btn.classList.remove('revealed'));
        }
        // Always return buttons to initial position when at top
        if (buttons) {
          buttons.classList.remove('revealed');
          buttons.classList.add('initial');
          computeInitialOffset();
        }
      } else if (scrollY > 0) {
        hasScrolled = true;
        // State 2 or 3: Check each button individually
        const boundaryY = getHeroContentBoundary();
        const allButtons = tools.querySelectorAll('.tool, .tool-round');
        
        // Always add with-labels class when scrolling
        tools.classList.remove('revealed', 'all-revealed');
        tools.classList.add('with-labels');
        
        // Check each button individually
        let allRevealed = true;
        allButtons.forEach(button => {
          if (checkButtonCrossedBoundary(button, boundaryY)) {
            // Button has crossed boundary - apply revealed state
            button.classList.add('revealed');
          } else {
            // Button hasn't crossed boundary - remove revealed state
            button.classList.remove('revealed');
            allRevealed = false;
          }
        });
        
        // If all buttons are revealed, add all-revealed class to trigger left alignment
        if (allRevealed && allButtons.length > 0) {
          tools.classList.add('all-revealed');
        }
        
        if (buttons) {
          buttons.classList.add('revealed');
          buttons.classList.remove('initial');
        }
      }
    };
    
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', function() {
      computeInitialOffset();
      onScroll();
    });
    // Initialize state on load
    onScroll();
  })();
  
  // Preferences card handler
  (function() {
    const preferencesCard = document.getElementById('preferences-card');
    const preferencesButton = document.querySelector('.tool');
    const backButton = document.querySelector('.preferences-back-button');
    
    if (!preferencesCard || !preferencesButton) return;
    
    preferencesButton.addEventListener('click', function() {
      const isOpen = preferencesCard.classList.toggle('open');
      if (isOpen) {
        document.body.classList.add('preferences-open');
      } else {
        document.body.classList.remove('preferences-open');
      }
    });
    
    if (backButton) {
      backButton.addEventListener('click', function() {
        preferencesCard.classList.remove('open');
        document.body.classList.remove('preferences-open');
      });
    }
    
    // Copy button functionality - for both preferences card and map view
    const setupCopyButtons = function() {
      const copyButtons = document.querySelectorAll('.share-copy-button');
      const shareLinkInputs = document.querySelectorAll('.share-link-input');
      
      copyButtons.forEach(function(copyButton, index) {
        const shareLinkInput = shareLinkInputs[index];
        if (copyButton && shareLinkInput) {
          copyButton.addEventListener('click', function() {
            shareLinkInput.select();
            shareLinkInput.setSelectionRange(0, 99999); // For mobile devices
            try {
              document.execCommand('copy');
              // Visual feedback could be added here
            } catch (err) {
              // Fallback for modern browsers
              navigator.clipboard.writeText(shareLinkInput.value).catch(function(err) {
                console.error('Failed to copy:', err);
              });
            }
          });
        }
      });
    };
    
    setupCopyButtons();
    
    // Location buttons functionality
    const locationNoButton = document.querySelector('.location-no-button');
    const locationYesButton = document.querySelector('.location-yes-button');
    const locationNoIcon = document.querySelector('.location-no-button .location-icon');
    const locationYesIcon = document.querySelector('.location-yes-button .location-icon');
    
    if (locationNoButton && locationYesButton) {
      const updateIconFilters = function() {
        if (locationNoIcon) {
          locationNoIcon.style.filter = locationNoButton.classList.contains('active') ? 'brightness(0) invert(1)' : 'none';
        }
        if (locationYesIcon) {
          locationYesIcon.style.filter = locationYesButton.classList.contains('active') ? 'brightness(0) invert(1)' : 'none';
        }
      };
      
      locationNoButton.addEventListener('click', function() {
        locationNoButton.classList.add('active');
        locationYesButton.classList.remove('active');
        updateIconFilters();
      });
      
      locationYesButton.addEventListener('click', function() {
        locationYesButton.classList.add('active');
        locationNoButton.classList.remove('active');
        updateIconFilters();
      });
      
      // Initialize filter on load
      updateIconFilters();
    }
    
    // Location button handler - needs access to onScroll
    const locationButton = document.querySelectorAll('.tool-round')[0];
    const heroForLocation = document.getElementById('hero');
    const contentForLocation = document.getElementById('content');
    const toolsForLocation = document.getElementById('tools');
    const buttonsForLocation = document.getElementById('buttons');
    
    if (locationButton && heroForLocation && contentForLocation) {
      locationButton.addEventListener('click', function() {
        // Toggle map view by hiding hero and content
        const isMapView = heroForLocation.classList.toggle('map-view');
        
        if (isMapView) {
          // Show map view (background image) by hiding hero and content
          heroForLocation.classList.add('map-view');
          contentForLocation.classList.add('map-view');
          document.body.classList.add('map-view');
          
          // Show map sharing section
          const mapSharingSection = document.getElementById('map-sharing-section');
          if (mapSharingSection) {
            mapSharingSection.classList.add('active');
          }
          
          // Move buttons to state 2 (revealed) position
          if (buttonsForLocation) {
            buttonsForLocation.classList.remove('initial', 'default');
            buttonsForLocation.classList.add('revealed');
          }
          
          // Set tools to state 2 (with-labels) and keep them there
          if (toolsForLocation) {
            toolsForLocation.classList.remove('revealed', 'all-revealed');
            toolsForLocation.classList.add('with-labels');
            // Show all tool buttons with labels
            const allToolButtons = toolsForLocation.querySelectorAll('.tool, .tool-round');
            allToolButtons.forEach(btn => {
              btn.classList.remove('revealed');
            });
          }
          
          // Change location button (button 2) icon and text in map view
          const locationButtonIcon = locationButton.querySelector('.tool-icon');
          const locationButtonLabel = locationButton.querySelector('.tool-label');
          if (locationButtonIcon && locationButtonLabel) {
            locationButtonIcon.src = 'book-open.svg';
            locationButtonIcon.alt = 'return to stories';
            locationButtonLabel.textContent = 'return to stories';
          }
          
          // Change preferences button (button 1) text in map view
          const preferencesButton = document.querySelector('.tool');
          const preferencesButtonLabel = preferencesButton ? preferencesButton.querySelector('.tool-label') : null;
          if (preferencesButtonLabel) {
            preferencesButtonLabel.textContent = 'refine search';
          }
        } else {
          // Hide map view - restore hero and content
          heroForLocation.classList.remove('map-view');
          contentForLocation.classList.remove('map-view');
          document.body.classList.remove('map-view');
          
          // Hide map sharing section
          const mapSharingSection = document.getElementById('map-sharing-section');
          if (mapSharingSection) {
            mapSharingSection.classList.remove('active');
          }
          
          // Restore location button (button 2) icon and text
          const locationButtonIcon = locationButton.querySelector('.tool-icon');
          const locationButtonLabel = locationButton.querySelector('.tool-label');
          if (locationButtonIcon && locationButtonLabel) {
            locationButtonIcon.src = 'map_icon.svg';
            locationButtonIcon.alt = 'location';
            locationButtonLabel.textContent = 'location';
          }
          
          // Restore preferences button (button 1) text
          const preferencesButton = document.querySelector('.tool');
          const preferencesButtonLabel = preferencesButton ? preferencesButton.querySelector('.tool-label') : null;
          if (preferencesButtonLabel) {
            preferencesButtonLabel.textContent = 'preferences';
          }
          
          // Restore buttons and tools to current scroll position by triggering scroll
          if (buttonsForLocation) {
            buttonsForLocation.classList.remove('default');
          }
          // Trigger scroll event to restore state
          window.dispatchEvent(new Event('scroll'));
        }
      });
    }
  })();
  </script>
</body>
</html>


